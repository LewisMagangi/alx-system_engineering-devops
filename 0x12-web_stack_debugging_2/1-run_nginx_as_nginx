#!/usr/bin/env bash

# Update nginx configuration to run as nginx user and listen on port 8080
NGINX_CONF="/etc/nginx/nginx.conf"

# Modify the user directive
sed -i 's/^user .*/user nginx;/' $NGINX_CONF

# Modify the listen directive
sed -i 's/listen 80;/listen 8080;/' $NGINX_CONF

# Ensure nginx user exists
id -u nginx &>/dev/null || useradd -r -s /bin/false nginx

# Ensure appropriate ownership and permissions
chown -R nginx:nginx /var/www/html
chown -R nginx:nginx /var/log/nginx

# Restart nginx service to apply changes
service nginx restart
